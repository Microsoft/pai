protocolVersion: 2
name: cifar10_tf_4gpu_horovod_da6c483e_dd4b265a
type: job
jobRetryCount: 0
prerequisites:
  - type: dockerimage
    uri: 'openpai/standard:python_3.6-tensorflow_2.1.0-gpu'
    name: docker_image_0
taskRoles:
  taskrole:
    instances: 1
    completion:
      minFailedInstances: 1
      minSucceededInstances: -1
    taskRetryCount: 0
    dockerImage: docker_image_0
    resourcePerInstance:
      gpu: 3
      cpu: 12
      memoryMB: 24576
    commands:
      - >-
        wget
        https://raw.githubusercontent.com/suiguoxin/pai/edu-examples/contrib/edu-examples/cifar10_cnn_tf_horovod.py
      - >-
        HOROVOD_GPU_ALLREDUCE=NCCL HOROVOD_GPU_BROADCAST=NCCL pip install
        horovod
      - 'horovodrun -np 4 -H localhost:4 python cifar10_cnn_tf_horovod.py'
defaults:
  virtualCluster: default
extras:
  com.microsoft.pai.runtimeplugin:
    - plugin: ssh
      parameters:
        jobssh: true
    - plugin: teamwise_storage
      parameters:
        storageConfigNames:
          - nfs-storage
  # To submit a GPU-only job
  hivedScheduler:
    taskRoles:
      taskrole:S
        gpuType: DT
