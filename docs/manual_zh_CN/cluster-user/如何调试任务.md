# 如何调试任务

本文档介绍了如何使用SSH和TensorBoard插件调试作业。

**注:** 当IP地址是来自客户的环境（不是集群内部IP），这两个插件才能正常工作。 因此，如果PAI部署在某些云环境（例如Azure）中，则这两个插件将无法工作。

## 如何使用SSH

OpenPAI提供SSH插件供您连接到作业容器。 要使用SSH，你可以创建一个SSH密钥对，或使用自己预先生成的密钥。

**选项1.创建SSH密钥对**

提交作业时，创建一个新的SSH密钥对是可行的。 首先，打开`工具`面板，启用SSH插件，然后单击`SSH密钥生成器`：

   <img src="./imgs/ssh-click-generator.png" width="60%" height="60%" />

生成器将为您生成一个公钥和一个私钥。 请下载SSH私钥，然后单击`使用公钥`按钮以在您的工作中使用此密钥对。 


   <img src="./imgs/ssh-generator.png" width="60%" height="60%" />

提交作业后，您可以通过容器ip和ssh端口以root用户身份使用下载的私钥将ssh放入作业容器。 `查看SSH信息`按钮将为您提供相应的命令：


   <img src="./imgs/view-ssh-info.png" width="100%" height="100%" />

详细而言，您应该参考`使用预先下载的SSH私钥`部分。如果您使用的是Windows，则以下命令适用于您：

```bash
ssh -p <ssh-port> -i <your-private-key-file-path> root@<container-ip>
```

在类Unix系统上，命令为：

```bash
chmod 400 <your-private-key-file-path> && ssh -p <ssh-port> -i <your-private-key-file-path> <container-ip>
```

**选项2.使用您自己的密钥**

如果您熟悉SSH密钥身份验证，则可能已经在文件夹`C:\Users\<your-user-name>\.ssh中生成了一个公共密钥和一个私有密钥。 ssh /`（在类似Unix的系统上是`~/.ssh/`）。该文件夹中有一个id_rsa.pub文件和一个id_rsa文件，分别是公钥和私钥。

要使用它们，请打开 `id_rsa.pub`并将其内容复制到SSH插件，然后提交作业。不要使用密钥生成器。

   <img src="./imgs/copy-ssh-public-key.png" width="60%" height="60%" />

提交后，您可以使用`ssh -p <ssh-port> root@<container-ip>`直接连接到作业容器。

## 如何使用TensorBoard插件

[TensorBoard](https://www.tensorflow.org/guide/summaries_and_tensorboard) 是检查和了解您的TensorFlow运行和图形套件的Web应用程序。

在这里，我们利用一个示例向您展示如何在OpenPAI中使用TensorBoard。首先，打开作业提交页面，在`命令`框中输入以下命令：

```bash
git clone https://github.com/microsoft/pai.git
cd pai
git reset --hard dd08930431d05ed490cf7ceeecd262e473c187cd
cd docs/user/samples/
python minist_tensorboard.py --data_dir ./data --log_dir /mnt/tensorboard
sleep 30m
```

然后，请选择`TensorFlow 1.15.0 + Python 3.6 with GPU, CUDA 10.0`作为您的docker映像。 最后但同样重要的是，在`工具`部分中切换`启用TensorBoard`按钮。

   <img src="./imgs/enable-tensorboard.png" width="100%" height="100%" />

提交后，您将在作业详细信息页面上看到一个`转到TensorBoard页面`按钮。

   <img src="./imgs/go-to-tensorboard-page.png" width="100%" height="100%" />

该按钮将带您到TensorBoard页面。 您可能需要等待几分钟，直到日志准备就绪：

   <img src="./imgs/tensorboard-ok.png" width="100%" height="100%" />

一般来说，要使用TensorBoard插件，您应该：

  1. 将您的TensorFlow摘要日志保存到`/mnt/tensorboard`。
  2. 确保您使用的docker映像中已安装`tensorboard`。
  3. 如果您想在工作完成后使用TensorBoard，请使用`sleep`命令来延长工作寿命。
