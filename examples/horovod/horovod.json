{
  "jobName": "horovod-mpi-cifar10",
  "image": "openpai/example.horovod.mpi",
  "dataDir": "$PAI_DEFAULT_FS_URI/examples/tensorflow/distributed-cifar-10/data",
  "outputDir": "$PAI_DEFAULT_FS_URI/examples/horovod/output",
  "codeDir": "$PAI_DEFAULT_FS_URI/examples/horovod/code",
  "virtualCluster": "default",
  "retryCount": 0,
  "taskRoles": [
    {
      "name": "main",
      "taskNumber": 1,
      "cpuNumber": 4,
      "memoryMB": 16384,
      "shmMB": 64,
      "gpuNumber": 2,
      "minFailedTaskCount": 1,
      "minSucceededTaskCount": 1,
      "command": "mpirun -np 4 -H worker-0:2,main-0:2 -bind-to none -map-by slot -x NCCL_DEBUG=INFO -x LD_LIBRARY_PATH -x PATH -x NCCL_SOCKET_IFNAME=eth0 -x NCCL_IB_DISABLE=1 -x CLASSPATH=$($HADOOP_HDFS_HOME/bin/hadoop classpath --glob) -mca pml ob1 -mca btl ^openib -mca btl_tcp_if_exclude docker0,lo,eth1  python code/benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --model resnet20 --batch_size 32 --data_dir=$PAI_DATA_DIR  --data_name=cifar10 --train_dir=$PAI_OUTPUT_DIR --variable_update horovod"
    },
    {
      "name": "worker",
      "taskNumber": 1,
      "cpuNumber": 4,
      "memoryMB": 16384,
      "shmMB": 64,
      "gpuNumber": 2,
      "minFailedTaskCount": 1,
      "minSucceededTaskCount": null,
      "command": "sleep infinity"
    }
  ]
}
